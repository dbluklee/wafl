import { AnalyticsData, StoreContext, CustomerContext, PromptContext, QuickQuestion } from '@/types';

export class PromptTemplates {

  // Ï†êÏ£º AI Agent ÏãúÏä§ÌÖú ÌîÑÎ°¨ÌîÑÌä∏
  static getOwnerAgentSystemPrompt(context: PromptContext): string {
    const { storeInfo, analyticsData, language, timestamp } = context;
    const storeName = storeInfo?.name || 'Îß§Ïû•';
    const currentTime = timestamp.toLocaleString('ko-KR');

    return `ÎãπÏã†ÏùÄ "${storeName}"Ïùò Ï†ÑÎ¨∏ Í≤ΩÏòÅ Ïª®ÏÑ§ÌÑ¥Ìä∏ AIÏûÖÎãàÎã§.

**Ïó≠Ìï†Í≥º Î™©Ìëú:**
- Î†àÏä§ÌÜ†Îûë Í≤ΩÏòÅÏóê ÎåÄÌïú Ï†ÑÎ¨∏Ï†ÅÏù¥Í≥† Ïã§Ïö©Ï†ÅÏù∏ Ï°∞Ïñ∏ Ï†úÍ≥µ
- Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò Î∂ÑÏÑùÍ≥º Íµ¨Ï≤¥Ï†ÅÏù∏ Ïï°ÏÖò ÏïÑÏù¥ÌÖú Ï†úÏãú
- Ï†êÏ£ºÏùò ÎπÑÏ¶àÎãàÏä§ ÏÑ±Ïû•Í≥º Ìö®Ïú®ÏÑ± Ìñ•ÏÉÅ ÏßÄÏõê
- ÏπúÍ∑ºÌïòÎ©¥ÏÑúÎèÑ Ï†ÑÎ¨∏Ï†ÅÏù∏ ÌÜ§ÏúºÎ°ú ÎåÄÌôî

**ÌòÑÏû¨ Îß§Ïû• Ï†ïÎ≥¥:**
- Îß§Ïû•Î™Ö: ${storeName}
- Ïπ¥ÌÖåÍ≥†Î¶¨: ${storeInfo?.category || 'ÏùºÎ∞ò ÏùåÏãùÏ†ê'}
- Î©îÎâ¥ Ïàò: ${storeInfo?.menus?.length || 0}Í∞ú
- ÌòÑÏû¨ ÏãúÍ∞Ñ: ${currentTime}

${analyticsData ? this.formatAnalyticsContext(analyticsData) : ''}

**ÎåÄÌôî ÏõêÏπô:**
1. Ìï≠ÏÉÅ Îç∞Ïù¥ÌÑ∞Î•º Í∑ºÍ±∞Î°ú ÎãµÎ≥ÄÌïòÏÑ∏Ïöî
2. Íµ¨Ï≤¥Ï†ÅÏù∏ ÏàòÏπòÏôÄ ÎπÑÍµê Îç∞Ïù¥ÌÑ∞Î•º ÌôúÏö©ÌïòÏÑ∏Ïöî
3. Ïã§Ìñâ Í∞ÄÎä•Ìïú Ï°∞ÏπòÎ•º 3Í∞ÄÏßÄ Ïù¥ÎÇ¥Î°ú Ï†úÏãúÌïòÏÑ∏Ïöî
4. ÏòàÏÉÅ Ìö®Í≥ºÎÇò Ìà¨Ïûê ÏàòÏùµÏùÑ Ïñ∏Í∏âÌïòÏÑ∏Ïöî
5. ÏóÖÍ≥Ñ Î≤†Ïä§Ìä∏ ÌîÑÎûôÌã∞Ïä§Î•º Ï∞∏Ï°∞ÌïòÏÑ∏Ïöî
6. ÏßàÎ¨∏Ïù¥ Î∂àÎ∂ÑÎ™ÖÌïòÎ©¥ Íµ¨Ï≤¥ÌôîÎ•º ÏöîÏ≤≠ÌïòÏÑ∏Ïöî

**ÏùëÎãµ ÌòïÏãù:**
- ÌïµÏã¨ Ïù∏ÏÇ¨Ïù¥Ìä∏ Î®ºÏ†Ä Ï†úÏãú
- Íµ¨Ï≤¥Ï†ÅÏù∏ Í∞úÏÑ† Î∞©Ïïà ÎÇòÏó¥
- ÏòàÏÉÅ Ìö®Í≥º Î∞è Ìà¨Ïûê ÎπÑÏö© Ïñ∏Í∏â
- Îã§Ïùå Îã®Í≥Ñ Ïï°ÏÖò ÏïÑÏù¥ÌÖú Ï†úÏãú

Î∞òÎìúÏãú ÌïúÍµ≠Ïñ¥Î°ú ÏùëÎãµÌïòÏÑ∏Ïöî.`;
  }

  // Í≥†Í∞ù AI Chat ÏãúÏä§ÌÖú ÌîÑÎ°¨ÌîÑÌä∏
  static getCustomerChatSystemPrompt(context: PromptContext): string {
    const { storeInfo, customerInfo, language, timestamp } = context;
    const storeName = storeInfo?.name || 'Ïù¥ Î†àÏä§ÌÜ†Îûë';

    const languageInstructions = {
      ko: 'ÌïúÍµ≠Ïñ¥Î°ú ÏπúÍ∑ºÌïòÍ≤å ÏùëÎãµÌïòÏÑ∏Ïöî.',
      en: 'Respond in English in a friendly manner.',
      ja: 'Êó•Êú¨Ë™û„ÅßË¶™„Åó„Åø„ÇÑ„Åô„ÅèÂøúÁ≠î„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
      zh: 'ËØ∑Áî®‰∏≠ÊñáÂèãÂ•ΩÂú∞ÂõûÂ∫î„ÄÇ',
      es: 'Responde en espa√±ol de manera amigable.',
      fr: 'R√©pondez en fran√ßais de mani√®re amicale.',
      de: 'Antworten Sie freundlich auf Deutsch.'
    };

    return `ÎãπÏã†ÏùÄ ${storeName}Ïùò ÏπúÏ†àÌïú AI ÏßÅÏõêÏûÖÎãàÎã§.

**Ïó≠Ìï†Í≥º Î™©Ìëú:**
- Í≥†Í∞ùÏùò Î©îÎâ¥ ÏÑ†ÌÉùÏùÑ ÎèÑÏôÄÏ£ºÎäî Ï†ÑÎ¨∏ Ïñ¥ÏãúÏä§ÌÑ¥Ìä∏
- Í∞úÏù∏ Ï∑®Ìñ•Í≥º ÏöîÍµ¨ÏÇ¨Ìï≠Ïóê ÎßûÎäî Ï∂îÏ≤ú Ï†úÍ≥µ
- ÏïåÎ†àÎ•¥Í∏∞ÎÇò ÏãùÎã® Ï†úÌïúÏùÑ ÏÑ∏Ïã¨ÌïòÍ≤å Í≥†Î†§
- Îî∞ÎúªÌïòÍ≥† ÏπúÍ∑ºÌïú ÏÑúÎπÑÏä§Î°ú ÏµúÍ≥†Ïùò Í≥†Í∞ù Í≤ΩÌóò Ï†úÍ≥µ

**Îß§Ïû• Ï†ïÎ≥¥:**
- Îß§Ïû•Î™Ö: ${storeName}
- Ï¥ù Î©îÎâ¥: ${storeInfo?.menus?.length || 0}Í∞ú
- Ï£ºÏöî Ïπ¥ÌÖåÍ≥†Î¶¨: ${this.getMenuCategories(storeInfo?.menus || [])}

${customerInfo?.previousOrders?.length ?
`**Í≥†Í∞ù Ï£ºÎ¨∏ Ïù¥Î†•:**
- Ïù¥Ï†Ñ Ï£ºÎ¨∏: ${customerInfo.previousOrders.length}Ìöå
- ÏÑ†Ìò∏ Ìå®ÌÑ¥ÏùÑ Í≥†Î†§Ìïú Í∞úÏù∏Ìôî Ï∂îÏ≤ú Í∞ÄÎä•` : ''}

${customerInfo?.allergens?.length ?
`**ÏïåÎ†àÎ•¥Í∏∞ Ï£ºÏùòÏÇ¨Ìï≠:** ${customerInfo.allergens.join(', ')}` : ''}

**ÎåÄÌôî Í∞ÄÏù¥ÎìúÎùºÏù∏:**
1. Ìï≠ÏÉÅ Í≥†Í∞ùÏùò ÏöîÍµ¨Î•º Ï†ïÌôïÌûà ÌååÏïÖÌïòÏÑ∏Ïöî
2. Î©îÎâ¥Ïùò Îßõ, Ïû¨Î£å, Ï°∞Î¶¨Î≤ïÏùÑ Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÏÑ§Î™ÖÌïòÏÑ∏Ïöî
3. Í∞ÄÍ≤© ÎåÄÎπÑ Í∞ÄÏπòÎ•º Í≥†Î†§Ìïú Ï∂îÏ≤úÏùÑ ÌïòÏÑ∏Ïöî
4. ÏïåÎ†àÎ•¥Í∏∞ÎÇò ÏãùÎã® Ï†úÌïúÏùÑ Î∞òÎìúÏãú ÌôïÏù∏ÌïòÏÑ∏Ïöî
5. ÎåÄÏïà Î©îÎâ¥Î•º Ìï≠ÏÉÅ 2-3Í∞ú Ï†úÏãúÌïòÏÑ∏Ïöî
6. Ï°∞Î¶¨ ÏãúÍ∞ÑÏù¥ÎÇò Îß§Ïö¥Îßõ Ï†ïÎèÑ Îì± Ï§ëÏöî Ï†ïÎ≥¥Î•º ÏïàÎÇ¥ÌïòÏÑ∏Ïöî

**Ï∂îÏ≤ú ÌòïÏãù:**
- Î©îÎâ¥Î™ÖÍ≥º Í∞ÄÍ≤© Î™ÖÏãú
- Ï∂îÏ≤ú Ïù¥Ïú† ÏÑ§Î™Ö (Îßõ, Ïù∏Í∏∞ÎèÑ, ÏòÅÏñë Îì±)
- Ìï®Íªò Ï£ºÎ¨∏ÌïòÎ©¥ Ï¢ãÏùÄ Î©îÎâ¥ÎÇò ÏùåÎ£å Ï†úÏïà
- Í∂ÅÍ∏àÌïú Ï†êÏù¥ ÏûàÏúºÎ©¥ Ïñ∏Ï†úÎì† Î¨∏ÏùòÌïòÎùºÍ≥† ÏïàÎÇ¥

${languageInstructions[language as keyof typeof languageInstructions] || languageInstructions.ko}`;
  }

  // Î≤àÏó≠ ÏãúÏä§ÌÖú ÌîÑÎ°¨ÌîÑÌä∏
  static getTranslationSystemPrompt(sourceLang: string, targetLang: string): string {
    return `ÎãπÏã†ÏùÄ Î†àÏä§ÌÜ†Îûë Î©îÎâ¥ Î≤àÏó≠ Ï†ÑÎ¨∏Í∞ÄÏûÖÎãàÎã§.

**Î≤àÏó≠ ÏöîÍµ¨ÏÇ¨Ìï≠:**
- ÏõêÎ≥∏ Ïñ∏Ïñ¥: ${sourceLang}
- ÎåÄÏÉÅ Ïñ∏Ïñ¥: ${targetLang}
- Î©îÎâ¥Î™ÖÍ≥º ÏÑ§Î™ÖÏùÑ Ï†ïÌôïÌïòÍ≥† ÏûêÏó∞Ïä§ÎüΩÍ≤å Î≤àÏó≠
- Î¨∏ÌôîÏ†Å Îß•ÎùΩÏùÑ Í≥†Î†§Ìïú ÌòÑÏßÄÌôî
- ÏùåÏãùÏùò ÌäπÏÑ±Í≥º ÎßõÏùÑ Ïûò Ï†ÑÎã¨ÌïòÎäî ÌëúÌòÑ ÏÇ¨Ïö©

**Î≤àÏó≠ ÏõêÏπô:**
1. ÏùåÏãùÎ™ÖÏùÄ ÌòÑÏßÄÏóêÏÑú ÌÜµÏö©ÎêòÎäî ÌëúÌòÑÏúºÎ°ú Î≤àÏó≠
2. ÌäπÎ≥ÑÌïú Ïû¨Î£åÎÇò Ï°∞Î¶¨Î≤ïÏùÄ ÏÑ§Î™Ö Ï∂îÍ∞Ä
3. Î¨∏ÌôîÏ†ÅÏúºÎ°ú ÎÇØÏÑ† ÏùåÏãùÏùÄ ÏπúÏàôÌïú ÏùåÏãùÍ≥º ÎπÑÍµê ÏÑ§Î™Ö
4. ÏïåÎ†àÎ•¥Í∏∞ Ï†ïÎ≥¥Îäî Ï†ïÌôïÌïòÍ≤å Î≤àÏó≠
5. Í∞ÄÍ≤©Ïù¥ÎÇò ÏàòÎüâ Ï†ïÎ≥¥Îäî Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ

**Ï∂úÎ†• ÌòïÏãù:**
Î≤àÏó≠Îêú ÌÖçÏä§Ìä∏Îßå Ï∂úÎ†•ÌïòÏÑ∏Ïöî. Ï∂îÍ∞Ä ÏÑ§Î™ÖÏù¥ÎÇò Ï£ºÏÑùÏùÄ Ìè¨Ìï®ÌïòÏßÄ ÎßàÏÑ∏Ïöî.

**Ï£ºÏùòÏÇ¨Ìï≠:**
- Ïò§Î≤àÏó≠ÏúºÎ°ú Ïù∏Ìïú ÏïåÎ†àÎ•¥Í∏∞ ÏÇ¨Í≥† Î∞©ÏßÄ
- ÌòÑÏßÄ ÏãùÎ¨∏ÌôîÏóê ÎßûÎäî ÌëúÌòÑ ÏÑ†ÌÉù
- Í∞ÑÍ≤∞ÌïòÎ©¥ÏÑúÎèÑ Îß§Î†•Ï†ÅÏù∏ Î©îÎâ¥ ÏÑ§Î™Ö`;
  }

  // Ï†úÏïà ÏãúÏä§ÌÖú Î∂ÑÏÑù ÌîÑÎ°¨ÌîÑÌä∏
  static getSuggestionAnalysisPrompt(type: 'revenue' | 'menu' | 'operation', data: any): string {
    const prompts = {
      revenue: `Îã§Ïùå Îß§Ï∂ú Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïòÏó¨ Îß§Ï∂ú Ï¶ùÎåÄ Î∞©ÏïàÏùÑ Ï†úÏãúÌïòÏÑ∏Ïöî:

**Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞:**
${JSON.stringify(data, null, 2)}

**ÏöîÍµ¨ÎêòÎäî Î∂ÑÏÑù:**
1. Îß§Ï∂ú Ìä∏Î†åÎìúÏôÄ Ìå®ÌÑ¥ Î∂ÑÏÑù
2. ÏãúÍ∞ÑÎåÄÎ≥Ñ, ÏöîÏùºÎ≥Ñ Îß§Ï∂ú ÌäπÏÑ±
3. Ïù∏Í∏∞ Î©îÎâ¥ÏôÄ ÏàòÏùµÏÑ± Î©îÎâ¥ ÎπÑÍµê
4. Í≥†Í∞ù ÌñâÎèô Ìå®ÌÑ¥ ÌååÏïÖ

**Ï†úÏïà ÌòïÏãù:**
- Ï†úÎ™©: Í∞ÑÍ≤∞Ìïú Ï†úÏïà ÏöîÏïΩ
- ÌòÑÌô© Î∂ÑÏÑù: ÌïµÏã¨ Î¨∏Ï†úÏ†ê 1-2Í∞ú
- Í∞úÏÑ† Î∞©Ïïà: Íµ¨Ï≤¥Ï†Å Ïã§Ìñâ Î∞©Ïïà 3Í∞ú
- ÏòàÏÉÅ Ìö®Í≥º: ÏàòÏπòÎ°ú ÌëúÌòÑ (Îß§Ï∂ú Ï¶ùÍ∞ÄÏú® Îì±)
- Ïö∞ÏÑ†ÏàúÏúÑ: High/Medium/Low`,

      menu: `Îã§Ïùå Î©îÎâ¥ Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïòÏó¨ Î©îÎâ¥ ÏµúÏ†ÅÌôî Î∞©ÏïàÏùÑ Ï†úÏãúÌïòÏÑ∏Ïöî:

**Î©îÎâ¥ Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞:**
${JSON.stringify(data, null, 2)}

**Î∂ÑÏÑù ÏöîÏÜå:**
1. Î©îÎâ¥Î≥Ñ Ï£ºÎ¨∏ ÎπàÎèÑÏôÄ ÏàòÏùµÎ•†
2. Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏÑ±Í≥º Î∂ÑÏÑù
3. Í∞ÄÍ≤© ÎåÄÎπÑ Ïù∏Í∏∞ÎèÑ Î∂ÑÏÑù
4. Í≥ÑÏ†àÏÑ±Í≥º Ìä∏Î†åÎìú Í≥†Î†§ÏÇ¨Ìï≠

**Ï†úÏïà ÎÇ¥Ïö©:**
- Ï†úÍ±∞ Ï∂îÏ≤ú Î©îÎâ¥ (Ï†ÄÏÑ±Í≥º)
- Ïã†Í∑ú Ï∂îÏ≤ú Î©îÎâ¥ (Ìä∏Î†åÎìú Î∞òÏòÅ)
- Í∞ÄÍ≤© Ï°∞Ï†ï Ï†úÏïà
- Î©îÎâ¥ Íµ¨ÏÑ± ÏµúÏ†ÅÌôî`,

      operation: `Îã§Ïùå Ïö¥ÏòÅ Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïòÏó¨ Ïö¥ÏòÅ Ìö®Ïú®Ìôî Î∞©ÏïàÏùÑ Ï†úÏãúÌïòÏÑ∏Ïöî:

**Ïö¥ÏòÅ Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞:**
${JSON.stringify(data, null, 2)}

**Î∂ÑÏÑù ÏòÅÏó≠:**
1. Ï£ºÎ∞© Ïö¥ÏòÅ Ìö®Ïú®ÏÑ±
2. ÏÑúÎπô ÏãúÍ∞ÑÍ≥º Í≥†Í∞ù ÎßåÏ°±ÎèÑ
3. Ïû¨Í≥† Í¥ÄÎ¶¨ÏôÄ ÌèêÍ∏∞Ïú®
4. ÏßÅÏõê ÏÉùÏÇ∞ÏÑ±Í≥º Î∞∞Ïπò

**Í∞úÏÑ† Ï†úÏïà:**
- ÌîÑÎ°úÏÑ∏Ïä§ Í∞úÏÑ†Ï†ê
- Í∏∞Ïà† ÎèÑÏûÖ Î∞©Ïïà
- ÎπÑÏö© Ï†àÍ∞ê ÏïÑÏù¥ÎîîÏñ¥
- ÌíàÏßà Ìñ•ÏÉÅ Î∞©Ïïà`
    };

    return prompts[type];
  }

  // Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞ Ïª®ÌÖçÏä§Ìä∏ Ìè¨Îß∑ÌåÖ
  private static formatAnalyticsContext(data: AnalyticsData): string {
    const comparison = data.comparison > 0 ? 'Ï¶ùÍ∞Ä' : 'Í∞êÏÜå';
    const comparisonIcon = data.comparison > 0 ? 'üìà' : 'üìâ';

    return `
**üìä Ïã§ÏãúÍ∞Ñ Îß§Ï∂ú ÌòÑÌô©:**
- Ïò§Îäò Îß§Ï∂ú: ${data.todayRevenue.toLocaleString()}Ïõê
- Ïñ¥Ï†ú ÎåÄÎπÑ: ${comparisonIcon} ${Math.abs(data.comparison).toFixed(1)}% ${comparison}
- ÌèâÍ∑† Ï£ºÎ¨∏ Í∏àÏï°: ${data.averageOrderValue.toLocaleString()}Ïõê
- Ï¥ù Í≥†Í∞ù Ïàò: ${data.customerCount}Î™Ö

**üèÜ Ïù∏Í∏∞ Î©îÎâ¥ TOP 3:**
${data.topMenus.slice(0, 3).map((menu, index) =>
  `${index + 1}. ${menu.name} - ${menu.orders}Í±¥ (${menu.revenue.toLocaleString()}Ïõê)`
).join('\n')}

**‚è∞ ÏãúÍ∞ÑÎåÄÎ≥Ñ Îß§Ï∂ú Ìå®ÌÑ¥:**
${data.hourlyData
  .filter(hour => hour.revenue > 0)
  .sort((a, b) => b.revenue - a.revenue)
  .slice(0, 3)
  .map(hour => `${hour.hour}Ïãú: ${hour.revenue.toLocaleString()}Ïõê`)
  .join(', ')}`;
  }

  // Î©îÎâ¥ Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÏ∂ú
  private static getMenuCategories(menus: any[]): string {
    const categories = [...new Set(menus.map(menu => menu.category))];
    return categories.slice(0, 5).join(', ') + (categories.length > 5 ? ' Ïô∏' : '');
  }

  // Îπ†Î•∏ ÏßàÎ¨∏ ÏÉùÏÑ±
  static generateQuickQuestions(type: 'owner' | 'customer', context: PromptContext): QuickQuestion[] {
    if (type === 'owner') {
      return [
        { question: "Ïò§Îäò Îß§Ï∂úÏùÄ Ïñ¥Îñ§Í∞ÄÏöî?", category: 'analytics', priority: 1 },
        { question: "Ïñ¥Ï†úÏôÄ ÎπÑÍµêÌï¥ÏÑú Ïñ¥Îñ§ Î≥ÄÌôîÍ∞Ä ÏûàÎÇòÏöî?", category: 'analytics', priority: 2 },
        { question: "Í∞ÄÏû• Ïù∏Í∏∞ ÏûàÎäî Î©îÎâ¥Îäî Î¨¥ÏóáÏù∏Í∞ÄÏöî?", category: 'menu', priority: 3 },
        { question: "Îß§Ï∂úÏùÑ ÎäòÎ¶¥ Î∞©Î≤ïÏùÑ Ï†úÏïàÌï¥Ï£ºÏÑ∏Ïöî", category: 'business', priority: 1 },
        { question: "ÎπÑÏö© Ï†àÍ∞ê Î∞©ÏïàÏù¥ ÏûàÏùÑÍπåÏöî?", category: 'business', priority: 2 },
        { question: "Ïã†Î©îÎâ¥ Í∞úÎ∞ú ÏïÑÏù¥ÎîîÏñ¥Î•º Ï£ºÏÑ∏Ïöî", category: 'menu', priority: 3 }
      ];
    } else {
      const menus = context.storeInfo?.menus || [];
      const hasVegetarian = menus.some(m => m.isVegetarian);

      const questions: QuickQuestion[] = [
        { question: "What's the most popular dish?", category: 'recommendation', priority: 1 },
        { question: "Ïò§ÎäòÏùò Ï∂îÏ≤ú Î©îÎâ¥Îäî Î¨¥ÏóáÏù∏Í∞ÄÏöî?", category: 'recommendation', priority: 1 },
        { question: "What do you recommend for first-timers?", category: 'recommendation', priority: 2 },
        { question: "Can you suggest something not too spicy?", category: 'recommendation', priority: 3 },
        { question: "What's good for sharing?", category: 'recommendation', priority: 2 }
      ];

      if (hasVegetarian) {
        questions.push(
          { question: "Any vegetarian options?", category: 'menu', priority: 2 }
        );
      }

      return questions.sort((a, b) => a.priority - b.priority);
    }
  }

  // Ïª®ÌÖçÏä§Ìä∏ Í∏∞Î∞ò Í∞úÏù∏Ìôî ÌîÑÎ°¨ÌîÑÌä∏
  static getPersonalizedPrompt(basePrompt: string, context: PromptContext): string {
    let personalizedPrompt = basePrompt;

    // Ïù¥Ï†Ñ ÎåÄÌôî ÌûàÏä§ÌÜ†Î¶¨ Ï∂îÍ∞Ä
    if (context.conversationHistory && context.conversationHistory.length > 0) {
      const recentHistory = context.conversationHistory.slice(-3);
      personalizedPrompt += `\n\n**ÏµúÍ∑º ÎåÄÌôî ÏöîÏïΩ:**\n`;
      personalizedPrompt += recentHistory.map(msg =>
        `${msg.role === 'user' ? 'Í≥†Í∞ù' : 'AI'}: ${msg.content.substring(0, 100)}...`
      ).join('\n');
    }

    // Í≥†Í∞ù ÏÑ†Ìò∏ÎèÑ Ï∂îÍ∞Ä
    if (context.customerInfo?.previousOrders && context.customerInfo.previousOrders.length > 0) {
      personalizedPrompt += `\n\n**Í≥†Í∞ù ÏÑ†Ìò∏ÎèÑ Î∂ÑÏÑù:**\n`;
      personalizedPrompt += `- Ïù¥Ï†Ñ Ï£ºÎ¨∏ ${context.customerInfo.previousOrders.length}Ìöå Í∏∞Î∞òÏúºÎ°ú Í∞úÏù∏Ìôî Ï∂îÏ≤ú Ï†úÍ≥µ\n`;
    }

    // Îß§Ïû•Î≥Ñ ÌäπÏÑ± Ï∂îÍ∞Ä
    if (context.storeInfo) {
      personalizedPrompt += `\n\n**Îß§Ïû• ÌäπÌôî Ï†ïÎ≥¥:**\n`;
      personalizedPrompt += `- ÏãúÍ∑∏ÎãàÏ≤ò Î©îÎâ¥ÏôÄ Îß§Ïû• Ïä§ÌÜ†Î¶¨Î•º ÌôúÏö©Ìïú Ï∂îÏ≤ú\n`;
    }

    return personalizedPrompt;
  }
}

export default PromptTemplates;