# WAFL AI Service

**WAFL AI POS Systemì˜ AI ì„œë¹„ìŠ¤** - Ollama ê¸°ë°˜ ì ì£¼ ê²½ì˜ ì»¨ì„¤íŒ…, ê³ ê° ëŒ€í™”, ë©”ë‰´ ì¶”ì²œ, ë‹¤êµ­ì–´ ë²ˆì—­ì„ ì œê³µí•˜ëŠ” í•µì‹¬ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

## ğŸ¯ ì„œë¹„ìŠ¤ ê°œìš”

- **ì„œë¹„ìŠ¤ëª…**: AI Service
- **í¬íŠ¸**: 4006
- **ë²„ì „**: 1.0.0
- **LLM ì—”ì§„**: Ollama (gemma3:27b-it-q4_K_M)
- **ê°œë°œ ì™„ë£Œì¼**: 2025.09.17

## ğŸš€ í•µì‹¬ ê¸°ëŠ¥

### 1. ì ì£¼ AI Agent (ê²½ì˜ ì»¨ì„¤íŒ…)
- ğŸ“Š **ì‹¤ì‹œê°„ ë¶„ì„**: ë§¤ì¶œ ë°ì´í„° ê¸°ë°˜ ê²½ì˜ ì¸ì‚¬ì´íŠ¸ ì œê³µ
- ğŸ¯ **ë§ì¶¤í˜• ì¡°ì–¸**: ë§¤ì¥ë³„ ë°ì´í„°ë¥¼ í™œìš©í•œ ê°œì„  ë°©ì•ˆ ì œì‹œ
- ğŸ“ˆ **ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸**: ìˆ˜ìµ ì¦ëŒ€, ë¹„ìš© ì ˆê°, ìš´ì˜ ìµœì í™” ì œì•ˆ
- ğŸ’¬ **ìì—°ì–´ ëŒ€í™”**: ì ì£¼ì™€ì˜ ìì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì–´ ëŒ€í™”
- ğŸ”„ **ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ**: Server-Sent Events ê¸°ë°˜ ì‹¤ì‹œê°„ ë‹µë³€

### 2. ê³ ê° AI Chat (ë©”ë‰´ ì¶”ì²œ)
- ğŸ½ï¸ **ë©”ë‰´ ì¶”ì²œ**: ê°œì¸ ì·¨í–¥ ê¸°ë°˜ ë§ì¶¤í˜• ë©”ë‰´ ì œì•ˆ
- ğŸŒ **ë‹¤êµ­ì–´ ì§€ì›**: í•œêµ­ì–´, ì˜ì–´, ì¼ë³¸ì–´, ì¤‘êµ­ì–´ ë“± 10ê°œ ì–¸ì–´
- ğŸš« **ì•Œë ˆë¥´ê¸° ê³ ë ¤**: ì•Œë ˆë¥´ê¸° ì •ë³´ ê¸°ë°˜ ì•ˆì „í•œ ë©”ë‰´ ì¶”ì²œ
- ğŸŒ± **ì‹ë‹¨ ì œí•œ**: ì±„ì‹, ë¹„ê±´ ë“± ì‹ë‹¨ ì œí•œ ê³ ë ¤
- ğŸ“ **ë¹ ë¥¸ ì§ˆë¬¸**: ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ ìë™ ìƒì„±

### 3. ë‹¤êµ­ì–´ ë²ˆì—­ ì„œë¹„ìŠ¤
- ğŸ“‹ **ë©”ë‰´ ë²ˆì—­**: ë©”ë‰´ëª…, ì„¤ëª…, ì•Œë ˆë¥´ê¸° ì •ë³´ ë²ˆì—­
- ğŸª **ë§¤ì¥ ì¼ê´„ë²ˆì—­**: ì „ì²´ ë©”ë‰´ ëŒ€ëŸ‰ ë²ˆì—­
- ğŸ­ **ë¬¸í™”ì  ì„¤ëª…**: í˜„ì§€ ë¬¸í™”ì— ë§ëŠ” ìŒì‹ ì„¤ëª… ì¶”ê°€
- âš¡ **ê³ ì„±ëŠ¥ ìºì‹±**: ë²ˆì—­ ê²°ê³¼ 1ì‹œê°„ ìºì‹œë¡œ ë¹ ë¥¸ ì‘ë‹µ
- ğŸ¯ **í’ˆì§ˆ í‰ê°€**: AI ê¸°ë°˜ ë²ˆì—­ í’ˆì§ˆ ìë™ í‰ê°€

### 4. ë¹„ì¦ˆë‹ˆìŠ¤ ì œì•ˆ ì‹œìŠ¤í…œ
- ğŸ“Š **ë§¤ì¶œ ë¶„ì„**: ì¼/ì£¼/ì›”ë³„ ë§¤ì¶œ íŒ¨í„´ ë¶„ì„
- ğŸœ **ë©”ë‰´ ìµœì í™”**: ì¸ê¸°ë„ì™€ ìˆ˜ìµì„± ê¸°ë°˜ ë©”ë‰´ ì œì•ˆ
- âš™ï¸ **ìš´ì˜ ê°œì„ **: íš¨ìœ¨ì„± í–¥ìƒì„ ìœ„í•œ ìš´ì˜ ë°©ì•ˆ ì œì‹œ
- ğŸ¨ **ë§ˆì¼€íŒ… ì•„ì´ë””ì–´**: ê³ ê° ìœ ì¹˜ë¥¼ ìœ„í•œ ë§ˆì¼€íŒ… ì „ëµ

## ğŸ—ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Backend Framework
- **Node.js** + **Express.js** + **TypeScript**
- **Ollama SDK** - LLM í†µì‹ 
- **Winston** - êµ¬ì¡°í™”ëœ ë¡œê¹…

### AI & Machine Learning
- **Ollama Server**: http://112.148.37.41:1884
- **LLM Model**: gemma3:27b-it-q4_K_M (27B íŒŒë¼ë¯¸í„°, Q4_K_M ì–‘ìí™”)
- **í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§**: ì—­í• ë³„ ìµœì í™”ëœ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸

### Performance & Caching
- **TTL ê¸°ë°˜ ì¸ë©”ëª¨ë¦¬ ìºì‹œ**: 30ì´ˆ/5ë¶„/1ì‹œê°„ ë‹¨ê³„ë³„ ìºì‹±
- **ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ**: SSE(Server-Sent Events) ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼
- **Rate Limiting**: API í˜¸ì¶œëŸ‰ ì œí•œ ë° ë³´í˜¸

### Security & Auth
- **JWT ì¸ì¦**: ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì™€ ë™ì¼í•œ í† í° ê²€ì¦
- **ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´**: ì ì£¼/ì§ì› ê¶Œí•œ ë¶„ë¦¬
- **ì…ë ¥ ê²€ì¦**: Express Validator ê¸°ë°˜ ìš”ì²­ ê²€ì¦

## ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸

### ì ì£¼ AI Agent (ì ì£¼ ì „ìš©)
```http
POST /api/v1/ai/agent/chat
GET  /api/v1/ai/agent/quick-questions
GET  /api/v1/ai/agent/sessions/:sessionId
POST /api/v1/ai/agent/sessions
GET  /api/v1/ai/agent/insights
POST /api/v1/ai/agent/sessions/:sessionId/summary
```

### ê³ ê° AI Chat (ê³µê°œ)
```http
POST /api/v1/ai/customer/chat
POST /api/v1/ai/customer/recommend
GET  /api/v1/ai/customer/quick-questions
```

### ë²ˆì—­ ì„œë¹„ìŠ¤ (ê³µê°œ)
```http
POST /api/v1/ai/translate/text
POST /api/v1/ai/translate/menu
POST /api/v1/ai/translate/batch
POST /api/v1/ai/translate/store/:storeId
```

### ì œì•ˆ ì‹œìŠ¤í…œ (ì ì£¼ ì „ìš©)
```http
GET  /api/v1/ai/suggestions/revenue
GET  /api/v1/ai/suggestions/menu
POST /api/v1/ai/analyze/feedback
```

### Health Check (ê³µê°œ)
```http
GET  /health
```

## ğŸš¦ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸

### 1. Health Check
```bash
curl http://localhost:4006/health
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "status": "healthy",
  "timestamp": "2025-09-17T07:21:30.592Z",
  "uptime": 10,
  "version": "1.0.0",
  "service": "ai-service",
  "dependencies": {
    "ollama": "connected",
    "cache": { "status": "active", "size": 0 }
  },
  "memory": { "rss": 116, "heapTotal": 40 },
  "environment": "development"
}
```

### 2. Ollama ì—°ê²° í™•ì¸
```bash
curl http://112.148.37.41:1884/api/tags
```

## ğŸ”§ ê°œë°œ í™˜ê²½ ì„¤ì •

### 1. í™˜ê²½ ë³€ìˆ˜ (.env)
```env
NODE_ENV=development
PORT=4006
DATABASE_URL=postgresql://postgres:Cl!Wm@Dp!Dl@Em!@localhost:5432/aipos
JWT_SECRET=your-jwt-secret-key-here-change-in-production

# Ollama Configuration
OLLAMA_BASE_URL=http://112.148.37.41:1884
OLLAMA_MODEL=gemma3:27b-it-q4_K_M

# AI Settings
AI_TEMPERATURE=0.7
AI_TOP_P=0.9
AI_MAX_TOKENS=2048
AI_STREAM=true
CONVERSATION_TTL=1800
CACHE_TTL=3600
RATE_LIMIT_ENABLED=true

# External Services
STORE_MANAGEMENT_URL=http://localhost:4002
DASHBOARD_SERVICE_URL=http://localhost:4003
ORDER_SERVICE_URL=http://localhost:4004
AUTH_SERVICE_URL=http://localhost:4001
```

### 2. ê°œë°œ ëª…ë ¹ì–´
```bash
# ê°œë°œ ì„œë²„ ì‹œì‘
npm run dev

# í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run build

# í”„ë¡œë•ì…˜ ì‹¤í–‰
npm start

# íƒ€ì… ì²´í¬
npm run type-check

# ë¦°íŠ¸ ê²€ì‚¬
npm run lint

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm test
```

## ğŸ”„ ì„œë¹„ìŠ¤ í†µí•©

### 1. ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì™€ì˜ ì—°ë™
- **Store Management Service** (4002): ë§¤ì¥/ë©”ë‰´ ì •ë³´ ì¡°íšŒ
- **Dashboard Service** (4003): ì‹¤ì‹œê°„ ë§¤ì¶œ ë¶„ì„ ë°ì´í„°
- **Order Service** (4004): ì£¼ë¬¸ íŒ¨í„´ ë° ê³ ê° ì„ í˜¸ë„ ë¶„ì„
- **Auth Service** (4001): JWT í† í° ê²€ì¦

### 2. ìºì‹œ ì „ëµ
- **ì§§ì€ ìºì‹œ (30ì´ˆ)**: ì‹¤ì‹œê°„ ë§¤ì¶œ ë°ì´í„°, ì£¼ë¬¸ í˜„í™©
- **ì¤‘ê°„ ìºì‹œ (5ë¶„)**: ë©”ë‰´ ì •ë³´, ë§¤ì¥ ì„¤ì •, ê³ ê° ì»¨í…ìŠ¤íŠ¸
- **ê¸´ ìºì‹œ (1ì‹œê°„)**: ë²ˆì—­ ê²°ê³¼, ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸

## ğŸ¨ ì‚¬ìš© ì˜ˆì‹œ

### 1. ì ì£¼ ê²½ì˜ ìƒë‹´ (ìŠ¤íŠ¸ë¦¬ë°)
```javascript
const eventSource = new EventSource('/api/v1/ai/agent/chat', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    sessionId: 'uuid-here',
    message: 'ì˜¤ëŠ˜ ë§¤ì¶œì´ ì–´ë–¤ê°€ìš”?',
    context: { includeAnalytics: true, dateRange: 'today' }
  })
});

eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.done) {
    console.log('ì‘ë‹µ ì™„ë£Œ:', data.metadata);
  } else {
    console.log('ì‹¤ì‹œê°„ ì‘ë‹µ:', data.chunk);
  }
};
```

### 2. ë©”ë‰´ ë²ˆì—­
```javascript
const response = await fetch('/api/v1/ai/translate/menu', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    menuId: 'menu-uuid',
    targetLang: 'en',
    includeAllergens: true
  })
});

const translation = await response.json();
console.log(translation.data);
// Output: { translatedName: "Kimchi Stew", culturalNotes: [...] }
```

### 3. ê³ ê° ë©”ë‰´ ì¶”ì²œ
```javascript
const response = await fetch('/api/v1/ai/customer/recommend', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    customerId: 'customer-id',
    preferences: ['ë§¤ìš´ë§›', 'í•´ì‚°ë¬¼'],
    budget: 30000,
    numberOfPeople: 2
  })
});

const recommendations = await response.json();
console.log(recommendations.data);
// Output: [{ name: "í•´ë¬¼ì°œ", reason: "ë§¤ìš´ë§›ê³¼ í•´ì‚°ë¬¼ ì„ í˜¸ë„ ë°˜ì˜", confidence: 0.9 }]
```

## ğŸ” ëª¨ë‹ˆí„°ë§ & ë¡œê¹…

### 1. Winston êµ¬ì¡°í™” ë¡œê¹…
- **ì¼ë³„ ë¡œê·¸ ë¡œí…Œì´ì…˜**: `logs/combined.log`, `logs/error.log`
- **AI ì „ìš© ë¡œê¹…**: ì±„íŒ… ìš”ì²­/ì‘ë‹µ, ë²ˆì—­, ìºì‹œ íˆíŠ¸ìœ¨
- **ì„±ëŠ¥ ì¶”ì **: ì‘ë‹µ ì‹œê°„, í† í° ì‚¬ìš©ëŸ‰, Ollama API í˜¸ì¶œ

### 2. ì‹¤ì‹œê°„ í†µê³„
```bash
# ìºì‹œ í†µê³„ í™•ì¸ (health ì—”ë“œí¬ì¸íŠ¸ì— í¬í•¨)
curl http://localhost:4006/health | jq '.dependencies.cache'

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
curl http://localhost:4006/health | jq '.memory'
```

### 3. ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…
- **ìºì‹œ ì •ë¦¬**: ë§¤ 5ë¶„ë§ˆë‹¤ ë§Œë£Œëœ ìºì‹œ ì—”íŠ¸ë¦¬ ì œê±°
- **ì„¸ì…˜ ì •ë¦¬**: ë§¤ 10ë¶„ë§ˆë‹¤ ë§Œë£Œëœ ëŒ€í™” ì„¸ì…˜ ì œê±°

## ğŸ› ï¸ ê°œë°œ ê°€ì´ë“œ

### 1. ìƒˆë¡œìš´ AI ê¸°ëŠ¥ ì¶”ê°€
1. `src/types/index.ts`ì— íƒ€ì… ì •ì˜ ì¶”ê°€
2. `src/services/` ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
3. `src/controllers/` ì— API í•¸ë“¤ëŸ¬ êµ¬í˜„
4. `src/routes/` ì— ë¼ìš°íŠ¸ ë“±ë¡
5. í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì„ `src/utils/prompt-templates.ts`ì— ì¶”ê°€

### 2. í”„ë¡¬í”„íŠ¸ ìµœì í™”
- ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ëŠ” ì—­í• ë³„ë¡œ ë¶„ë¦¬
- ì»¨í…ìŠ¤íŠ¸ ì •ë³´ë¥¼ ë™ì ìœ¼ë¡œ ì£¼ì…
- í† í° ì‚¬ìš©ëŸ‰ ìµœì†Œí™”ë¥¼ ìœ„í•œ ê°„ê²°í•œ í‘œí˜„
- í•œêµ­ì–´/ì˜ì–´ ì´ì¤‘ ì–¸ì–´ ì§€ì›

### 3. ìºì‹± ì „ëµ í™•ì¥
```typescript
// ìƒˆë¡œìš´ ìºì‹œ íƒ€ì… ì¶”ê°€ ì˜ˆì‹œ
cache.setLong(`custom:${key}`, data); // 1ì‹œê°„ ìºì‹œ
cache.getMedium<Type>(`another:${key}`); // 5ë¶„ ìºì‹œ ì¡°íšŒ
```

## ğŸš¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. Ollama ì—°ê²° ì‹¤íŒ¨
```bash
# Ollama ì„œë²„ ìƒíƒœ í™•ì¸
curl http://112.148.37.41:1884/api/tags

# ëª¨ë¸ ë¡œë“œ ìƒíƒœ í™•ì¸
curl http://112.148.37.41:1884/api/show -d '{"name":"gemma3:27b-it-q4_K_M"}'
```

### 2. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€
- ìºì‹œ í¬ê¸° ëª¨ë‹ˆí„°ë§: `/health` ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
- ëŒ€í™” ì„¸ì…˜ ì •ë¦¬: `contextService.cleanupExpiredSessions()`
- ìºì‹œ ìˆ˜ë™ ì •ë¦¬: `cache.cleanup()` í˜¸ì¶œ

### 3. ì‘ë‹µ ì†ë„ ì €í•˜
- ìºì‹œ íˆíŠ¸ìœ¨ í™•ì¸ (ëª©í‘œ: 70% ì´ìƒ)
- Ollama ì„œë²„ ë¶€í•˜ ìƒíƒœ ì ê²€
- í”„ë¡¬í”„íŠ¸ ê¸¸ì´ ìµœì í™” (2000ì ì´ë‚´ ê¶Œì¥)

## ğŸ“ ì—…ë°ì´íŠ¸ ë¡œê·¸

### v1.0.0 (2025.09.17)
- âœ… Ollama ê¸°ë°˜ AI ì„œë¹„ìŠ¤ ì™„ì „ êµ¬í˜„
- âœ… ì ì£¼ ê²½ì˜ ì»¨ì„¤íŒ… Agent ì™„ì„±
- âœ… ê³ ê° ë©”ë‰´ ì¶”ì²œ ì‹œìŠ¤í…œ ì™„ì„±
- âœ… 10ê°œ ì–¸ì–´ ë²ˆì—­ ì„œë¹„ìŠ¤ ì™„ì„±
- âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ ìƒì„± ì‹œìŠ¤í…œ
- âœ… SSE ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ êµ¬í˜„
- âœ… TTL ê¸°ë°˜ ìºì‹± ì‹œìŠ¤í…œ ì™„ì„±
- âœ… Rate Limiting ë° ë³´ì•ˆ ê°•í™”
- âœ… Winston êµ¬ì¡°í™” ë¡œê¹… ì™„ì„±
- âœ… TypeScript ì—„ê²© ëª¨ë“œ ì™„ì „ ì§€ì›

---

**ğŸ‰ AI Service êµ¬í˜„ ì™„ë£Œ!**

WAFL AI POS Systemì˜ í•µì‹¬ AI ê¸°ëŠ¥ì„ ëª¨ë‘ ê°–ì¶˜ ì™„ì „í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. Ollamaì™€ Gemma3 ëª¨ë¸ì„ í™œìš©í•˜ì—¬ ì ì£¼ì—ê²ŒëŠ” ì „ë¬¸ì ì¸ ê²½ì˜ ì»¨ì„¤íŒ…ì„, ê³ ê°ì—ê²ŒëŠ” ê°œì¸í™”ëœ ë©”ë‰´ ì¶”ì²œì„ ì œê³µí•©ë‹ˆë‹¤.

**í¬íŠ¸ 4006**ì—ì„œ ì‹¤í–‰ ì¤‘ì´ë©°, ë‹¤ë¥¸ WAFL ì„œë¹„ìŠ¤ë“¤ê³¼ ì™„ë²½í•˜ê²Œ í†µí•©ë©ë‹ˆë‹¤.